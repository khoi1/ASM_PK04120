@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model List<ASM_PK04120.Models.GioHangModel>

@{
    ViewData["Title"] = "Giỏ hàng của bạn";
    Layout = "~/Areas/KhachHang/Views/Shared/_Layout.cshtml";
    decimal tongTien = Model?.Sum(item => item.SanPham!.GiaBan * item.SoLuong) ?? 0;
}

<section class="ftco-section ftco-cart">
    <div class="container">
        @if (Model == null || !Model.Any())
        {
            <div class="row justify-content-center">
                <div class="col-md-12 text-center">
                    <h3 class="mb-4">Giỏ hàng của bạn đang trống</h3>
                    <p><a asp-action="SanPham" asp-controller="SanPham" class="btn btn-primary py-3 px-4">Bắt đầu mua sắm</a></p>
                </div>
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-md-12 ftco-animate">
                    <div class="cart-list">
                        <table class="table">
                            <thead class="thead-primary">
                                <tr class="text-center">
                                    <th>&nbsp;</th>
                                    <th>Sản phẩm</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Giá</th>
                                    <th>Số lượng</th>
                                    <th>Tổng cộng</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr class="text-center">
                                        <td class="product-remove">
                                            <form asp-area="KhachHang" asp-controller="GioHang" asp-action="XoaKhoiGio" asp-route-maGioHang="@item.MaGioHang" method="post">
                                                <button type="submit" class="btn-remove">
                                                    <span class="icon-close"></span>
                                                </button>
                                            </form>
                                        </td>
                                        <td class="image-prod"><div class="img" style="background-image:url(/KhachHang/images/AnhSP/@item.SanPham!.HinhAnh);"></div></td>
                                        <td class="product-name">
                                            <h3>@item.SanPham.TenSanPham</h3>
                                        </td>
                                        <td class="price">@item.SanPham.GiaBan.ToString("N0") VNĐ</td>

                                        @* THAY ĐỔI: Chỉ hiển thị số lượng, không cho sửa *@
                                        <td class="quantity">@item.SoLuong</td>

                                        <td class="total">@((item.SanPham.GiaBan * item.SoLuong).ToString("N0")) VNĐ</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row justify-content-end">
                <div class="col-lg-4 mt-5 cart-wrap ftco-animate">
                    <div class="cart-total mb-3">
                        <h3>Tổng Cộng</h3>
                        <p class="d-flex">
                            <span>Tạm tính</span>
                            <span>@tongTien.ToString("N0") VNĐ</span>
                        </p>
                        <hr>
                        <p class="d-flex total-price">
                            <span>Tổng cộng</span>
                            <span>@tongTien.ToString("N0") VNĐ</span>
                        </p>
                    </div>
                    <p><a href="#" class="btn btn-primary py-3 px-4">Tiến hành thanh toán</a></p>
                </div>
            </div>
        }
    </div>
</section>