@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model ASM_PK04120.Areas.KhachHang.Models.ChiTietSanPhamViewModel
@{
	Layout = "~/Areas/KhachHang/Views/Shared/_Layout.cshtml";
	ViewData["Title"] = "Trang chi tiết sản phẩm";
}

<section class="ftco-section" style="padding-bottom:0;">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 mb-5 ftco-animate">
                <a href="~/KhachHang/images/AnhSP/@Model.SanPham.HinhAnh" class="image-popup"><img src="~/KhachHang/images/AnhSP/@Model.SanPham.HinhAnh" class="img-fluid" alt="Ảnh sản phẩm"></a>
            </div>
            <div class="col-lg-6 product-details pl-md-5 ftco-animate">
                <form asp-area="KhachHang" asp-controller="GioHang" asp-action="ThemVaoGio" method="post">

                    @* Input ẩn để gửi mã sản phẩm đi *@
                    <input type="hidden" name="maSanPham" value="@Model.SanPham.MaSanPham" />

                    <h3>@Model.SanPham.TenSanPham</h3>
                    <p class="price"><span>@Model.SanPham.GiaBan.ToString("N0") VNĐ</span></p>
                    <p class="stock-quantity">
                        (Còn lại: @Model.SanPham.SoLuongConLai sản phẩm)
                    </p>
                    <div class="row mt-4">
                        <div class="w-100"></div>
                        <div class="input-group col-md-6 d-flex mb-3">
                            <span class="input-group-btn mr-2">
                                <button type="button" class="quantity-left-minus btn" data-type="minus">
                                    <i class="icon-minus"></i>
                                </button>
                            </span>

                            @* Sửa lại name="soLuong" để khớp với Action *@
                            <input type="text" id="quantity" name="soLuong" class="form-control input-number text-center" value="1" min="1" max="@Model.SanPham.SoLuongConLai">

                            <span class="input-group-btn ml-2">
                                <button type="button" class="quantity-right-plus btn" data-type="plus">
                                    <i class="icon-plus"></i>
                                </button>
                            </span>
                        </div>
                    </div>
                    <p><button type="submit" class="btn btn-primary py-3 px-5">Thêm vào giỏ hàng</button></p>
                </form>
            </div>
        </div>
    </div>
</section>

<section class="ftco-section" style="padding-top: 50px; padding-bottom: 3em;">
    <div class="container">
        <div class="row">
            <div class="col-md-12 ftco-animate">

                <div class="cart-total">
                    <h3 class="billing-heading mb-4 text-center"><strong style="color:#c49b63;">Thông Tin Chi Tiết Sản Phẩm</strong></h3>

                    <a href="~/KhachHang/images/AnhMoTa/@Model.SanPham.MoTa" class="image-popup"><img src="~/KhachHang/images/AnhMoTa/@Model.SanPham.MoTa" alt="Ảnh mô tả sản phẩm" /></a>
                    
                </div>

            </div>
        </div>
    </div>
</section>

<section class="ftco-section" style="padding-top:50px;">
    <div class="container">
        <div class="row justify-content-center mb-5 pb-3">
            <div class="col-md-7 heading-section ftco-animate text-center">
                <span class="subheading">Khám phá</span>
                <br>
                <h2 class="mb-4">Sản phẩm tương tự</h2>
                <p>Từ những vùng trồng trứ danh, chúng tôi cẩn trọng lựa chọn những hạt cà phê chất lượng nhất, mang đến hương vị đậm đà, nguyên bản trong từng sản phẩm.</p>
            </div>
        </div>
        <div class="row justify-content-center">
            @if (Model.SanPhamTuongTu != null && Model.SanPhamTuongTu.Any())
            {
                @foreach (var sanPham in Model.SanPhamTuongTu)
                {
                    <a class="col-md-3" style="margin-bottom:30px;" asp-route-id="@sanPham.MaSanPham" asp-area="KhachHang" asp-controller="SanPham" asp-action="ChiTietSanPham">
                        <div class="menu-entry">
                            <img src="~/KhachHang/images/AnhSP/@sanPham.HinhAnh" class="img" alt="Alternate Text" />
                            <div class="text text-center pt-4">
                                <h3>@sanPham.TenSanPham</h3>
                                <p class="price">@sanPham.GiaBan.ToString("N0") VNĐ</p>
                            </div>
                        </div>
                    </a>

                }
            }
            else
            {
                <div class="col-12 text-center">
                    <h2>Hiện chưa có sản phẩm tương tự nào.</h2>
                </div>
            }
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function(){

        var quantity = 1; // Giá trị số lượng ban đầu

        // Lấy các nút và ô input
        const plusBtn = document.querySelector('.quantity-right-plus');
        const minusBtn = document.querySelector('.quantity-left-minus');
        const quantityInput = document.getElementById('quantity');

        // Lấy số lượng tồn kho từ thuộc tính max của input
        const maxQuantity = parseInt(quantityInput.getAttribute('max'));

        // Xử lý khi nhấn nút '+'
        plusBtn.addEventListener('click', function(e){
            e.preventDefault();
            var currentVal = parseInt(quantityInput.value);
            // Chỉ tăng nếu giá trị hiện tại nhỏ hơn số lượng tồn kho
            if (!isNaN(currentVal) && currentVal < maxQuantity) {
                quantityInput.value = currentVal + 1;
            }
        });

        // Xử lý khi nhấn nút '-'
        minusBtn.addEventListener('click', function(e){
            e.preventDefault();
            var currentVal = parseInt(quantityInput.value);
            // Chỉ giảm nếu giá trị hiện tại lớn hơn 1
            if (!isNaN(currentVal) && currentVal > 1) {
                quantityInput.value = currentVal - 1;
            }
        });

    });
</script>
